<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bewegungsstatistik – Flughafen Zürich</title>

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

<style>
:root{
  --primary:#004bb5;
  --primary-light:#e8f0ff;
  --bg:#f4f6fa;
  --card:#ffffff;
  --border:#dcdfe6;
  --text:#1f2937;
  --radius:10px;
  --shadow:0 4px 12px rgba(0,0,0,.06);
  --container:1400px;
}

*{ box-sizing:border-box; }

html, body{
  height:100%;
  margin:0;
  font-family:system-ui,-apple-system,"Segoe UI",Roboto,Helvetica,Arial,sans-serif;
  background:var(--bg);
  color:var(--text);
}

/* MAP */
#map{
  position:fixed;
  inset:0;
  z-index:1;
}

/* HEADER */
header{
  position:fixed;
  top:24px;
  left:50%;
  transform:translateX(-50%);
  width:calc(100% - 48px);
  max-width:var(--container);
  padding:20px 24px;
  background:var(--card);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  z-index:1000;
}

.header-title{
  font-size:26px;
  font-weight:600;
  margin-bottom:4px;
}

.header-subtitle{
  font-size:14px;
  color:#4b5563;
  margin-bottom:12px;
}

/* HEADER ACTIONS */
.header-actions{
  position:absolute;
  top:16px;
  right:20px;
  display:flex;
  flex-direction:column;
  gap:6px;
  align-items:flex-end;
}

.toggle-row{
  display:flex;
  gap:6px;
}

/* INPUTS */
.address-row{
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  margin-bottom:4px;
  align-items:center;
}

.address-wrapper{
  position:relative;
  flex:1;
  min-width:260px;
}

.address-row input{
  width:100%;
  padding:10px 12px;
  font-size:14px;
  border-radius:6px;
  border:1px solid var(--border);
}

.address-row button,
.reset-btn{
  padding:8px 14px;
  font-size:14px;
  font-weight:500;
  border-radius:6px;
  border:1px solid var(--border);
  background:#fff;
  cursor:pointer;
}

.address-row button:hover,
.reset-btn:hover{
  background:var(--primary-light);
}

/* AUTOCOMPLETE */
#suggestions{
  position:absolute;
  top:100%;
  left:0;
  right:0;
  background:#fff;
  border:1px solid var(--border);
  border-top:none;
  max-height:220px;
  overflow-y:auto;
  list-style:none;
  margin:0;
  padding:0;
  z-index:2000;
}

#suggestions li{
  padding:8px 12px;
  cursor:pointer;
  font-size:14px;
}

#suggestions li:hover{
  background:var(--primary-light);
}

/* TOGGLE */
.toggle{
  display:inline-flex;
  align-items:center;
  gap:8px;
  padding:6px 10px;
  background:var(--primary-light);
  border-radius:999px;
  font-size:14px;
  cursor:pointer;
  user-select:none;
}

.toggle input{ display:none; }

.toggle-slider{
  position:relative;
  width:36px;
  height:18px;
  background:#cbd5e1;
  border-radius:999px;
  transition:.25s;
}

.toggle-slider::before{
  content:"";
  position:absolute;
  top:2px;
  left:2px;
  width:14px;
  height:14px;
  background:#fff;
  border-radius:50%;
  transition:.25s;
}

.toggle input:checked + .toggle-slider{
  background:var(--primary);
}

.toggle input:checked + .toggle-slider::before{
  transform:translateX(18px);
}

/* LABELS */
.gemeinde-label{
  background:rgba(255,255,255,0.9);
  border:1px solid #004bb5;
  color:#003a8f;
  font-weight:600;
  padding:4px 8px;
  border-radius:6px;
  box-shadow:0 2px 6px rgba(0,0,0,.2);
  font-size:12px;
}

/* Quadranten nur Buchstaben */
.quadrant-label{
  background: none;
  border: none;
  box-shadow: none;
  color: #003a8f;
  font-weight: 700;
  font-size: 16px;
}

/* IMPRESSUM */
.impressum{
  position:fixed;
  bottom:10px;
  left:10px;
  font-size:12px;
  background:var(--card);
  padding:6px 10px;
  border-radius:6px;
  box-shadow:var(--shadow);
  z-index:1000;
}

/* ZOOM OFFSET */
.leaflet-bottom.leaflet-left .leaflet-control-zoom{
  margin-bottom:60px;
}
</style>
</head>

<body>

<div id="map"></div>

<header>
  <div class="header-title">Bewegungsstatistik – Flughafen Zürich</div>
  <div class="header-subtitle">
    Geben Sie Ihre Adresse ein oder klicken Sie auf Ihre Region rund um den Flughafen.
  </div>

  <div class="address-row">
    <div class="address-wrapper">
      <input id="addressInput" placeholder="Adresse eingeben" autocomplete="off">
      <ul id="suggestions"></ul>
    </div>
    <button id="searchBtn">Adresse anzeigen</button>
    <button class="reset-btn" id="resetViewBtn">Zum Flughafen</button>
  </div>

  <!-- Switcher -->
  <div class="header-actions">
    <!-- Zeile 1: Pisten + Routen -->
    <div class="toggle-row">
      <label class="toggle">
        <input type="checkbox" id="togglePiste">
        <span class="toggle-slider"></span>
        <span>Pisten</span>
      </label>

      <label class="toggle">
        <input type="checkbox" id="toggleRouten">
        <span class="toggle-slider"></span>
        <span>Routen</span>
      </label>
    </div>

    <!-- Zeile 2: Gemeinden -->
    <div class="toggle-row">
      <label class="toggle">
        <input type="checkbox" id="toggleGemeinden">
        <span class="toggle-slider"></span>
        <span>Gemeinden</span>
      </label>
    </div>
  </div>
</header>

<div class="impressum">© Abteilung OVL, Flughafen Zürich AG</div>

<script>
/* ================= MAP INIT ================= */
const airportCenter = [47.458, 8.555];
const airportZoom = 11;

const map = L.map('map', { center: airportCenter, zoom: airportZoom, zoomControl:false });
L.control.zoom({ position:'bottomleft' }).addTo(map);

L.tileLayer.wms('https://wms.geo.admin.ch/', {
  layers:'ch.swisstopo.pixelkarte-farbe',
  opacity:0.4,
  attribution:'© swisstopo'
}).addTo(map);

/* ================= RESET ================= */
document.getElementById('resetViewBtn')
  .addEventListener('click', () => { map.setView(airportCenter, airportZoom); });

/* ================= QUADRANTEN ================= */
const bounds = { north:47.60, south:47.32, west:8.30, east:8.80 };
const styles = {
  nw:{ color:'#003a8f', fillColor:'#004bb5' },
  ne:{ color:'#005fd1', fillColor:'#2f6fff' },
  sw:{ color:'#006bb3', fillColor:'#5b8dff' },
  se:{ color:'#004bb5', fillColor:'#89aaff' }
};

const quadrantLayer = L.layerGroup().addTo(map);

function addQuadrant(b, style, url, label){
  const r = L.rectangle(b,{ ...style, weight:2, fillOpacity:.18, dashArray:'4,4' });
  r.on('mouseover',()=>r.setStyle({ fillOpacity:.32, dashArray:null }));
  r.on('mouseout',()=>r.setStyle({ fillOpacity:.18, dashArray:'4,4' }));
  r.on('click',()=>window.location.href=url);

  // Tooltip direkt am Rechteck, nur Buchstaben
  r.bindTooltip(label, {
    permanent: true,
    direction: 'center',
    className: 'quadrant-label'
  });

  quadrantLayer.addLayer(r);
}

addQuadrant([[airportCenter[0],bounds.west],[bounds.north,airportCenter[1]]],styles.nw,'seite1.html','NW');
addQuadrant([[airportCenter[0],airportCenter[1]],[bounds.north,bounds.east]],styles.ne,'seite2.html','NE');
addQuadrant([[bounds.south,bounds.west],[airportCenter[0],airportCenter[1]]],styles.sw,'seite3.html','SW');
addQuadrant([[bounds.south,airportCenter[1]],[airportCenter[0],bounds.east]],styles.se,'seite4.html','SE');

/* ================= GEMEINDEN ================= */
let gemeindenLayer = null;
let selectedGemeinde = null;
const gemeindeStyle = { color:'#004bb5', weight:2, fillColor:'#5b8dff', fillOpacity:.18, dashArray:'4,4' };
const gemeindeSelectedStyle = { color:'#003a8f', weight:3, fillColor:'#004bb5', fillOpacity:0.45, dashArray:null };

fetch('Gemeinden_ZH.geojson').then(r=>r.json()).then(g=>{
  gemeindenLayer = L.geoJSON(g, {
    style:gemeindeStyle,
    onEachFeature:(f,l)=>{
      const name=f.properties.NAME;
      l.on('mouseover',()=>{ if(selectedGemeinde!==l) l.setStyle({ fillOpacity:.32, dashArray:null }); });
      l.on('mouseout',()=>{ if(selectedGemeinde!==l) l.setStyle(gemeindeStyle); });
      l.on('click',()=>{
        if(selectedGemeinde){ selectedGemeinde.setStyle(gemeindeStyle); selectedGemeinde.unbindTooltip(); }
        selectedGemeinde = l;
        l.setStyle(gemeindeSelectedStyle);
        l.bindTooltip(name,{ permanent:true, direction:'center', className:'gemeinde-label' }).openTooltip();
      });
    }
  });
});

document.getElementById('toggleGemeinden').addEventListener('change', e=>{
  if(!gemeindenLayer) return;
  if(e.target.checked){ map.removeLayer(quadrantLayer); gemeindenLayer.addTo(map); }
  else { map.addLayer(quadrantLayer); map.removeLayer(gemeindenLayer); }
});

/* ================= PISTEN ================= */
let pisteLayer=null;
fetch('ZRH_Pisten.geojson').then(r=>r.json()).then(g=>{
  pisteLayer=L.geoJSON(g,{ style:{ color:'#d90429', weight:3 }});
});
document.getElementById('togglePiste').addEventListener('change',e=>{
  if(!pisteLayer) return;
  e.target.checked ? pisteLayer.addTo(map) : map.removeLayer(pisteLayer);
});

/* ================= ROUTEN ================= */
let routenLayer=null;
fetch('ZRH_Routen.geojson').then(r=>r.json()).then(g=>{
  routenLayer=L.geoJSON(g,{ style:{ color:'#ffa500', weight:3 }});
});
document.getElementById('toggleRouten').addEventListener('change',e=>{
  if(!routenLayer) return;
  e.target.checked ? routenLayer.addTo(map) : map.removeLayer(routenLayer);
});

/* ================= AUTOCOMPLETE ================= */
const input=document.getElementById('addressInput');
const suggestions=document.getElementById('suggestions');
let marker=null, timer=null;

async function search(q){
  const r = await fetch(
    'https://nominatim.openstreetmap.org/search?' +
    new URLSearchParams({ q, format:'json', limit:5, countrycodes:'ch' })
  );
  return r.json();
}

function show(item){
  suggestions.innerHTML='';
  input.value=item.display_name;
  if(marker) map.removeLayer(marker);
  marker=L.marker([+item.lat,+item.lon]).addTo(map)
    .bindPopup(item.display_name).openPopup();
  map.setView([+item.lat,+item.lon],14);
}

input.addEventListener('input',()=>{
  clearTimeout(timer);
  if(input.value.length<3){ suggestions.innerHTML=''; return; }
  timer=setTimeout(async()=>{
    const data=await search(input.value);
    suggestions.innerHTML='';
    data.forEach(i=>{
      const li=document.createElement('li');
      li.textContent=i.display_name;
      li.onclick=()=>show(i);
      suggestions.appendChild(li);
    });
  },300);
});

document.getElementById('searchBtn').addEventListener('click',async()=>{
  const d=await search(input.value);
  if(d.length) show(d[0]);
});

document.addEventListener('click', e=>{
  if(!e.target.closest('.address-wrapper')) suggestions.innerHTML='';
});
</script>

</body>
</html>
